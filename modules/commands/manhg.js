const url="https://raw.githubusercontent.com/manhkhac/mirai-1.2.14/main/repoG.json?token=AJ7TTLNYL3J2YMZE6QYBSNLBK32QK",evtUrl="https://raw.githubusercontent.com/manhkhac/mirai-1.2.8/data/modules/events/{name}.js",cmdUrl="https://raw.githubusercontent.com/manhkhac/mirai-1.2.8/data/modules/commands/{name}.js";module.exports.config={name:"manhg",version:"1.0.1",hasPermssion:2,credits:"ManhG",description:"Tải hoặc cập nhật tất cả module của ManhG",commandCategory:"admin",usages:"[install/uninstall/update/bỏ trống]",cooldowns:1,dependencies:{axios:"","fs-extra":"",path:""}},module.exports.languages={vi:{nameExist:"Tên module bị trùng với một module mang cùng tên khác!",notFoundLanguage:"Module %1 không hỗ trợ ngôn ngữ ngôn ngữ của bạn",notFoundPackage:"Không tìm thấy package %1 hỗ trợ cho module %2, tiến hành cài đặt...",cantInstallPackage:"Không thể cài đặt package %1 cho module %2, lỗi: %3",loadedPackage:"Đã tải thành công toàn bộ package cho module %1",loadedConfig:"Đã tải thành công config cho module %1",cantLoadConfig:"Không thể tải config của module %1, lỗi: %2",cantOnload:"Không thể khởi chạy setup của module %1, lỗi: %1",successLoadModule:"Đã tải thành công module %1",failLoadModule:"Không thể tải thành công module %1, lỗi: %2",moduleError:"Những module đã xảy ra sự cố không mong muốn khi đang tải: \n\n%1"},en:{nameExist:"Module's name is similar to another module!",notFoundLanguage:"Module %1 does not support your language",notFoundPackage:"Can't find package %1 for module %2, install...",cantInstallPackage:"Can't install package %1 for module %2, error: %3",loadedPackage:"Loaded package for module %1",loadedConfig:"Loaded config for module %1",cantLoadConfig:"Can't load config for module %1, error: %2",cantOnload:"Can't load setup for module %1, error: %1",successLoadModule:"Loaded module %1",failLoadModule:"Can't load module %1, error: %2",moduleError:"Modules which have unexpected error when loading: \n\n%1"}},module.exports.version=function(){const{resolve:n}=global.nodemodule.path;try{var e=n(__dirname,"cache","manhG.json"),a=require(e),o=a.version}catch(e){o="1.0.0"}return[o,e,a]},module.exports.onLoad=async function(){const n=global.nodemodule.axios,e=require(process.cwd()+"/utils/log"),{existsSync:a,writeFileSync:o}=global.nodemodule["fs-extra"],{data:t}=await n.get(url);var[s,i,c]=this.version();if(a(i)){const n=c;n.hasOwnProperty("version")||(n.version="1.0.0"),o(i,JSON.stringify(n,null,4))}else o(i,JSON.stringify({version:s},null,4));t.version!=s&&(e("[!] Đã có bản cập nhật mới [!]","[ ManhG ]"),e(`Phiên bản ${t.version}`,"[ ManhG ]"),e(`Các module có sự thay đổi: ${t.change.join(", ")}`,"[ ManhG ]")),e("Show zú sẽ có mọi thứ :3","[ ManhG ]")},module.exports.getAll=async function(){const n=global.nodemodule.axios,{data:e}=await n.get(url);return[e.modules,e]},module.exports.getName=async function(){var n={events:{},commands:{}};for(const e of global.client.events.values())"ManhG"==e.config.credits&&(n.events[e.config.name]=e.config.version);for(const e of global.client.commands.values())"ManhG"==e.config.credits&&(n.commands[e.config.name]=e.config.version);return n},module.exports.falseVersion=async function(n,e){var a={events:{},commands:{}};return Object.keys(n.commands).map((o=>e.commands[o]==n.commands[o]&&e.commands[o]||(a.commands[o]=[n.commands[o],e.commands[o]||null,o]))),Object.keys(n.events).map((o=>e.events[o]==n.events[o]&&e.events[o]||(a.events[o]=[n.events[o],e.events[o]||null,o]))),a},module.exports.update=async function(n,e){const a=global.nodemodule.axios,{existsSync:o,writeFileSync:t,unlinkSync:s}=global.nodemodule["fs-extra"],{data:i}=await a.get(n);o(e)&&await s(e),await new Promise((n=>setTimeout(n,200))),await t(e,Buffer.from(i,"utf-8"))},module.exports.switchArgs=function(n){switch(n[1]){case void 0:case"all":return"all";default:return"idk"}},module.exports.run=async function({args:n,event:e,api:a,getText:o}){async function t(n,a){const t=require("./command"),s=require("./event");if(n.length,Array.isArray(n)){var i={moduleList:n,threadID:e.threadID,messageID:e.messageID,getText:o};0!=n.length&&("commands"===a?t.loadCommand(i):"events"===a&&s.loadCommand(i))}}const s=await this.getName(),[i,c]=await this.getAll(),r=Object.keys(i.commands),l=Object.keys(i.events),{resolve:d}=global.nodemodule.path,{commands:m,events:u}=await this.falseVersion(i,s),h=(n,o=function(){})=>a.sendMessage(n,e.threadID,o),{writeFileSync:g,unlinkSync:f}=global.nodemodule["fs-extra"];var[v,p,w]=this.version();switch(n[0]){case"install":if("all"==this.switchArgs(n)){w.version=c.version,await g(p,JSON.stringify(w,null,4));var y="» Commands:\n",b="» Events:\n";l.forEach((n=>b+=`- ${n}: ${i.events[n]}\n`)),r.forEach((n=>y+=`- ${n}: ${i.commands[n]}\n`)),h("Thao tác này sẽ tải xuống toàn bộ modules.",(async()=>h("Bao gồm các modules:\n"+y+b)));for(const n of r){const e=d(__dirname,`${n}.js`);await this.update(cmdUrl.replace("{name}",n),e)}for(const n of l){const e=d(__dirname,"../events",`${n}.js`);await this.update(evtUrl.replace("{name}",n),e)}h("[!] Tải xuống hoàn tất [!]"),await t(l,"events"),await t(r,"commands")}break;case"update":if("all"==this.switchArgs(n)){if(0==Object.keys(m).length&&0==Object.keys(u).length)return h("==== ManhG ====\n» Tất cả các module hiện đang ở phiên bản mới nhất!");w.version=c.version,await g(p,JSON.stringify(w,null,4));const n=Object.keys(m),e=Object.keys(u);y="» Module Command:\n",b="» Module Event:\n";e.forEach((n=>b+=`- ${n}:\n    + Current version: ${u[n][1]}\n    + Latest version: ${u[n][0]}\n`)),n.forEach((n=>y+=`- ${n}:\n    + Current version: ${m[n][1]}\n    + Latest version: ${m[n][0]}\n`)),h(`Tiến hành update..\n${y}${b}`);for(const e of n){const n=d(__dirname,`${e}.js`);await this.update(cmdUrl.replace("{name}",e),n)}for(const n of e){const e=d(__dirname,"../events",`${n}.js`);await this.update(evtUrl.replace("{name}",n),e)}h("[!] Cập nhật hoàn tất [!]"),await t(e,"events"),await t(n,"commands")}break;case"uninstall":if("all"==this.switchArgs(n)){w.version="1.0.0",await g(p,JSON.stringify(w,null,4));for(const n of r)"ManhG"!=n&&await f(d(__dirname,n+".js"));for(const n of l)await f(d(__dirname,"../events",n+".js"));h("[!] Đã gỡ cài đặt tất cả module của Mew [!]",(()=>h("Để cài đặt lại, hãy sử dụng lệnh ManhG install")))}break;default:h(`==== ManhG ====\n» Phiên bản hiện tại: ${v}\n» Phiên bản mới nhất: ${c.version}\n» Module thay đổi: ${c.change.join(", ")}\n» `+(c.version==v?"Bạn đang sử dụng phiên bản mới nhất.":"Đã có bản cập nhật mới, hãy update."))}};
